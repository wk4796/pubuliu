<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片画廊</title>
    <meta name="description" content="一个展示精彩瞬间的瀑布流图片画廊。">

    <style>
        :root {
            --bg-color: #f0fdf4;
            --text-color: #14532d;
            --text-color-light: #15803d;
            --primary-color: #22c55e;
            --primary-color-dark: #16a34a;
            --border-color: #bbf7d0;
            --header-bg: rgba(240, 253, 244, 0.8);
        }
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        html {
            -webkit-text-size-adjust: 100%;
            line-height: 1.5;
            scroll-behavior: smooth;
        }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, 'Noto Sans', sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        body.lightbox-open { overflow: hidden; }
        
        /* --- 头部和筛选按钮 --- */
        .header-sticky { 
            text-align: center;
            padding-top: 1rem; 
            padding-bottom: 1rem; 
            background-color: rgba(240, 253, 244, 0); 
            position: sticky; 
            top: 0; 
            z-index: 40; 
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); 
            transition: padding 0.3s ease-in-out, background-color 0.3s ease-in-out; 
        }
        .header-sticky.state-scrolled-partially { 
            padding-top: 0.75rem; 
            padding-bottom: 0.75rem; 
            background-color: var(--header-bg);
            backdrop-filter: blur(8px); 
        }
        .header-sticky.state-scrolled-fully { 
            padding-top: 0.5rem; 
            padding-bottom: 0.5rem; 
            background-color: var(--header-bg);
            backdrop-filter: blur(8px); 
        }
        .header-sticky h1 { 
            font-size: 2.25rem;
            font-weight: 700;
            margin-bottom: 1rem;
            opacity: 1; 
            transition: opacity 0.3s ease-in-out, margin-bottom 0.3s ease-in-out, height 0.3s ease-in-out;
        }
        @media (min-width: 768px) { .header-sticky h1 { font-size: 3rem; } }
        .header-sticky.state-scrolled-fully h1 { 
            opacity: 0; 
            margin-bottom: 0; 
            height: 0; 
            overflow: hidden; 
            pointer-events: none; 
        }
        .filter-buttons {
            display: flex;
            justify-content: center;
        }
        .filter-buttons > :not([hidden]) ~ :not([hidden]) { margin-left: 0.5rem; } /* space-x-2 */
        .filter-btn { 
            padding: 0.5rem 1rem; 
            border-radius: 9999px; 
            font-weight: 500; 
            transition: all 0.2s ease; 
            border: 1px solid transparent; 
            cursor: pointer; 
            background-color: transparent;
            color: var(--text-color);
        }
        .filter-btn:hover { background-color: #dcfce7; }
        .filter-btn.active { 
            background-color: var(--primary-color); 
            color: white; 
            border-color: var(--primary-color-dark);
        }
        
        /* --- 主体和画廊 --- */
        .main-container {
            width: 100%;
            max-width: 80rem; /* max-w-7xl */
            margin-left: auto;
            margin-right: auto;
            padding: 2rem 1.5rem; /* py-8 px-6 */
            flex-grow: 1;
        }
        @media (min-width: 768px) { .main-container { padding-top: 2.5rem; padding-bottom: 2.5rem; } } /* md:py-10 */
        .grid-gallery { 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); 
            grid-auto-rows: 10px; 
            gap: 1rem; 
            max-width: 80rem;
            margin-left: auto;
            margin-right: auto;
        }
        .grid-item { 
            position: relative; 
            border-radius: 0.5rem; 
            overflow: hidden; 
            background-color: #e4e4e7; 
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); 
            opacity: 0; 
            transform: translateY(20px); 
            transition: opacity 0.5s ease-out, transform 0.5s ease-out, box-shadow 0.3s ease; 
        }
        .grid-item-wide { grid-column: span 2; }
        @media (max-width: 400px) { .grid-item-wide { grid-column: span 1; } }
        .grid-item.is-visible { opacity: 1; transform: translateY(0); }
        .grid-item img { 
            cursor: pointer; 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            display: block; 
            transition: transform 0.4s ease; 
        }
        .grid-item:hover img { transform: scale(1.05); }
        .loader {
            text-align: center;
            padding: 2rem 0;
            color: var(--text-color-light);
            display: none; /* JS控制显示 */
        }
        .loader.visible { display: block; }
        
        /* --- 页脚 --- */
        .footer {
            text-align: center;
            padding: 2rem 0;
            margin-top: auto;
            border-top: 1px solid var(--border-color);
        }
        .footer p { color: var(--text-color-light); }

        /* --- 灯箱 (图片放大) --- */
        .lightbox { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.9); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.3s ease; }
        .lightbox.active { opacity: 1; visibility: visible; }
        .lightbox-image { max-width: 85%; max-height: 85%; display: block; object-fit: contain; }
        .lightbox-btn { position: absolute; top: 50%; transform: translateY(-50%); background-color: rgba(255,255,255,0.1); color: white; border: none; font-size: 2.5rem; cursor: pointer; padding: 0.5rem 1rem; border-radius: 0.5rem; transition: background-color 0.2s; }
        .lightbox-btn:hover { background-color: rgba(255,255,255,0.2); }
        .lb-prev { left: 1rem; }
        .lb-next { right: 1rem; }
        .lb-close { top: 1rem; right: 1rem; font-size: 2rem; }
        .lb-counter { position: absolute; top: 1.5rem; left: 50%; transform: translateX(-50%); color: white; font-size: 1rem; background-color: rgba(0,0,0,0.3); padding: 0.25rem 0.75rem; border-radius: 9999px; }
        .lb-download { position: absolute; bottom: 1rem; right: 1rem; background-color: var(--primary-color); color: white; border: none; padding: 0.5rem 1rem; border-radius: 0.5rem; cursor: pointer; transition: background-color 0.2s; font-size: 1rem; }
        .lb-download:hover { background-color: var(--primary-color-dark); }
        
        /* --- 返回顶部按钮 --- */
        .back-to-top { position: fixed; bottom: 2rem; right: 2rem; background-color: var(--primary-color); color: white; width: 3rem; height: 3rem; border-radius: 9999px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 8px rgba(0,0,0,0.2); cursor: pointer; opacity: 0; visibility: hidden; transform: translateY(20px); transition: all 0.3s ease; }
        .back-to-top.visible { opacity: 1; visibility: visible; transform: translateY(0); }
    </style>
</head>
<body>

    <header class="header-sticky">
        <h1>图片画廊</h1>
        <div class="filter-buttons">
            <button class="filter-btn active" data-filter="all">全部</button>
            <button class="filter-btn" data-filter="random">随机</button>
            <button class="filter-btn" data-filter="二次元">二次元</button>
            <button class="filter-btn" data-filter="风景">风景</button>
        </div>
    </header>

    <main class="main-container">
        <div id="gallery-container" class="grid-gallery"></div>
        <div id="loader" class="loader">正在加载更多...</div>
    </main>
    
    <footer class="footer">
        <p>© <span id="copyright-year"></span> 图片画廊</p>
    </footer>

    <div class="lightbox">
        <span class="lb-counter"></span>
        <button class="lightbox-btn lb-close" aria-label="关闭">&times;</button>
        <button class="lightbox-btn lb-prev" aria-label="上一张">&lsaquo;</button>
        <img class="lightbox-image" alt="">
        <button class="lightbox-btn lb-next" aria-label="下一张">&rsaquo;</button>
        <a class="lb-download" role="button" aria-label="下载图片">下载</a> 
    </div>

    <a class="back-to-top" title="返回顶部">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 19V5M5 12l7-7 7 7"/></svg>
    </a>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            
            // ===============================================================
            //  >>>>> 在这里添加或修改你的图片 <<<<<
            // ===============================================================
            const imageData = [
                { src: 'https://tu.665410.xyz/5VK3U8DR9Q1V.jpg', category: '风景' },
                { src: 'https://tu.665410.xyz/DY8Y4VG0HQ1V.png', category: '二次元' },
                { src: 'https://tu.665410.xyz/T3T0QM05HQ1V.jpg', category: '风景' },
                { src: 'https://tu.665410.xyz/7ZX4548R9Q1V.jpg', category: '二次元' },
                { src: 'https://tu.665410.xyz/DJUP64A4HQ1V.jpg', category: '风景' },
                { src: 'https://tu.665410.xyz/HU8A1PQ23Q1V.png', category: '二次元' },
                { src: 'https://tu.665410.xyz/5VK3U8DR9Q1V.jpg', category: '风景' },
                { src: 'https://tu.665410.xyz/DY8Y4VG0HQ1V.png', category: '二次元' },
                { src: 'https://tu.665410.xyz/T3T0QM05HQ1V.jpg', category: '风景' },
                { src: 'https://tu.665410.xyz/7ZX4548R9Q1V.jpg', category: '二次元' },
                { src: 'https://tu.665410.xyz/DJUP64A4HQ1V.jpg', category: '风景' },
                { src: 'https://tu.665410.xyz/HU8A1PQ23Q1V.png', category: '二次元' },
            ];

            const galleryContainer = document.getElementById('gallery-container');
            const loader = document.getElementById('loader');
            const itemsPerLoad = 6;
            let currentFilter = 'all';
            let filteredData = [];
            let itemsLoaded = 0;
            let isRendering = false;

            /**
             * 功能一：初始化画廊和筛选功能
             */
            function initImageGallery() {
                // 懒加载观察器
                const imageObserver = new IntersectionObserver((entries, observer) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            const item = entry.target;
                            const img = item.querySelector('img');
                            img.src = img.dataset.src;
                            img.onload = () => {
                                item.style.backgroundColor = 'transparent';
                                item.classList.add('is-visible');
                                resizeSingleGridItem(item);
                            };
                            observer.unobserve(item);
                        }
                    });
                }, { rootMargin: '0px 0px 200px 0px' });

                // 渲染图片项目
                function renderItems() {
                    if (isRendering || itemsLoaded >= filteredData.length) {
                        loader.classList.remove('visible');
                        return;
                    }
                    isRendering = true;
                    loader.classList.add('visible');
                    const itemsToRender = filteredData.slice(itemsLoaded, itemsLoaded + itemsPerLoad);
                    itemsToRender.forEach((data, index) => {
                        const item = document.createElement('div');
                        item.className = 'grid-item';
                        item.dataset.category = data.category;
                        item.dataset.index = itemsLoaded + index;
                        const img = document.createElement('img');
                        img.src = "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";
                        img.dataset.src = data.src;
                        img.alt = ""; // 移除了描述，alt设置为空
                        img.onerror = () => item.remove();
                        item.appendChild(img);
                        galleryContainer.appendChild(item);
                        imageObserver.observe(item);
                    });
                    itemsLoaded += itemsToRender.length;
                    loader.classList.remove('visible');
                    isRendering = false;
                }

                // 筛选按钮事件
                const filterButtons = document.querySelectorAll('.filter-btn');
                filterButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        if (isRendering) return;
                        currentFilter = button.dataset.filter;
                        filterButtons.forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                        galleryContainer.innerHTML = '';
                        itemsLoaded = 0;
                        if (currentFilter === 'all') {
                            filteredData = imageData;
                        } else if (currentFilter === 'random') {
                            filteredData = [...imageData].sort(() => 0.5 - Math.random());
                        } else {
                            filteredData = imageData.filter(item => item.category === currentFilter);
                        }
                        renderItems();
                    });
                });
                
                // 窗口大小调整事件
                window.addEventListener('resize', () => {
                    const items = galleryContainer.querySelectorAll('.grid-item.is-visible');
                    items.forEach(resizeSingleGridItem);
                });

                // 初始化
                filteredData = imageData;
                renderItems();

                // 暴露 renderItems 给滚动事件使用
                return { renderItems };
            }

            /**
             * 功能二：初始化灯箱 (图片放大)
             */
            function initLightbox() {
                const lightbox = document.querySelector('.lightbox');
                const lightboxImage = lightbox.querySelector('.lightbox-image');
                const lbCounter = lightbox.querySelector('.lb-counter');
                const lbPrev = lightbox.querySelector('.lb-prev');
                const lbNext = lightbox.querySelector('.lb-next');
                const lbClose = lightbox.querySelector('.lb-close');
                const lbDownload = lightbox.querySelector('.lb-download');
                let currentImageIndex = 0;
                let lastFocusedElement;
                
                function updateLightbox() {
                    const currentItem = filteredData[currentImageIndex];
                    if (!currentItem) return;
                    lightboxImage.src = currentItem.src;
                    lightboxImage.alt = ""; // 移除了描述，alt设置为空
                    lbDownload.href = currentItem.src;
                    lbDownload.download = `image_${currentImageIndex + 1}`; // 设置下载文件名
                    lbCounter.textContent = `${currentImageIndex + 1} / ${filteredData.length}`;
                }

                function openLightbox(index) {
                    lastFocusedElement = document.activeElement;
                    currentImageIndex = index;
                    updateLightbox();
                    lightbox.classList.add('active');
                    document.body.classList.add('lightbox-open');
                    lbClose.focus();
                }

                function closeLightbox() {
                    lightbox.classList.remove('active');
                    document.body.classList.remove('lightbox-open');
                    if (lastFocusedElement) lastFocusedElement.focus();
                }

                function showPrevImage() {
                    currentImageIndex = (currentImageIndex - 1 + filteredData.length) % filteredData.length;
                    updateLightbox();
                }

                function showNextImage() {
                    currentImageIndex = (currentImageIndex + 1) % filteredData.length;
                    updateLightbox();
                }

                galleryContainer.addEventListener('click', e => {
                    const item = e.target.closest('.grid-item');
                    if (item) openLightbox(parseInt(item.dataset.index));
                });

                lbPrev.addEventListener('click', showPrevImage);
                lbNext.addEventListener('click', showNextImage);
                lbClose.addEventListener('click', closeLightbox);
                lightbox.addEventListener('click', e => { if (e.target === lightbox) closeLightbox(); });

                document.addEventListener('keydown', e => {
                    if (!lightbox.classList.contains('active')) return;
                    if (e.key === 'ArrowLeft') showPrevImage();
                    if (e.key === 'ArrowRight') showNextImage();
                    if (e.key === 'Escape') closeLightbox();
                });
            }

            /**
             * 功能三：初始化滚动相关行为
             */
            function initScrollBehaviors(galleryControls) {
                const backToTopBtn = document.querySelector('.back-to-top');
                const header = document.querySelector('.header-sticky');
                let ticking = false;

                function handleScroll() {
                    const scrollY = window.scrollY;
                    // 返回顶部按钮
                    backToTopBtn.classList.toggle('visible', scrollY > 300);
                    // 头部样式
                    header.classList.toggle('state-scrolled-fully', scrollY > 50);
                    header.classList.toggle('state-scrolled-partially', scrollY > 0 && scrollY <= 50);
                    // 无限滚动加载
                    if (window.innerHeight + scrollY >= document.body.offsetHeight - 500) {
                        galleryControls.renderItems();
                    }
                }

                window.addEventListener('scroll', () => {
                    if (!ticking) {
                        window.requestAnimationFrame(() => {
                            handleScroll();
                            ticking = false;
                        });
                        ticking = true;
                    }
                });

                backToTopBtn.addEventListener('click', () => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }
            
            /**
             * 功能四：动态更新页脚版权年份
             */
            function updateCopyrightYear() {
                const yearSpan = document.getElementById('copyright-year');
                if (yearSpan) {
                    const startYear = 2025;
                    const currentYear = new Date().getFullYear();
                    yearSpan.textContent = (currentYear > startYear) ? `${startYear}-${currentYear}` : startYear;
                }
            }

            // --- 辅助函数 ---
            function resizeSingleGridItem(item) {
                const img = item.querySelector('img');
                if (!img || !img.complete || img.naturalHeight === 0) return;
                const rowHeight = 10, rowGap = 16;
                const ratio = img.naturalWidth / img.naturalHeight;
                if (ratio > 1.2) { item.classList.add('grid-item-wide'); } 
                else { item.classList.remove('grid-item-wide'); }
                if (img.clientWidth > 0) {
                    const rowSpan = Math.ceil(( (img.clientWidth / ratio) + rowGap) / (rowHeight + rowGap));
                    item.style.gridRowEnd = `span ${rowSpan}`;
                }
            }
            
            // --- 初始化所有功能 ---
            function initializeApp() {
                const galleryControls = initImageGallery();
                initLightbox();
                initScrollBehaviors(galleryControls);
                updateCopyrightYear();
            }

            initializeApp();
        });
    </script>
</body>
</html>
